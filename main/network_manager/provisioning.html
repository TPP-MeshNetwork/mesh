<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Provisioning Form</title>
    <style>
        html{
            height: 100vh;
        }
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        font-family: Arial, sans-serif;
        background-image: linear-gradient(180deg,#141b2d,#0c3653);
        color: white;
      }
      h2 {
        margin-top: 1em;
        color: white;
        align-items: center;
      }
      .ssid-list {
        display: flex;
        gap: 1em;
        align-items: center;
      }
      .form {
        padding-top: 2em;
      }
      form {
        max-width: 300px;
        margin: 0 auto;
      }
      input[type="text"],
      input[type="password"] {
        width: 100%;
        padding: 10px;
        margin: 5px 0;
      }
      input[type="submit"] {
        width: 100%;
        padding: 10px;
        background-color: #4caf50;
        color: white;
        border: none;
      }
      input[type="submit"]:hover {
        background-color: #45a049;
      }
      #spinner {
        width: 48px;
        height: 48px;
        border: 3px solid #FFF;
        border-radius: 50%;
        display: inline-block;
        position: relative;
        box-sizing: border-box;
        animation: rotation 1s linear infinite;
        display: none;
} 
    #spinner::after {
    content: '';  
    box-sizing: border-box;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 56px;
    height: 56px;
    border-radius: 50%;
    border: 3px solid transparent;
    border-bottom-color: #FF3D00;
    }

    @keyframes rotation {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
    } 
    </style>
  </head>
  <body>
    <div class="logo">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -25 300 120" width="300" height="120" fill="#394240">
        <text x="50.25" y="45" font-size="44" font-weight="bold" fill="white">M</text>
        <text x="101.25" y="45" font-size="40" font-weight="bold" fill="white">I</text>
        <text x="131.25" y="45" font-size="40" font-weight="bold" fill="white">L</text>
        <g transform="translate(191.25 30)">
          <circle r="17" stroke="#288ccb" stroke-width="5" fill="none"/>
          <path stroke="green" stroke-width="3" d="m-10-16-15-19"/>
          <circle cx="-33" cy="-42" r="10" stroke="#f6e72e" stroke-width="5" fill="none"/>
          <path stroke="green" stroke-width="3" d="M0 20v15"/>
          <circle cy="44" r="10" stroke="#d71411" stroke-width="5" fill="none"/>
          <path stroke="green" stroke-width="3" d="m-7 17-28 28"/>
          <circle cx="-42" cy="52" r="10" stroke="#7e22da" stroke-width="5" fill="none"/>
        </g>
        <text x="226.25" y="45" font-size="40" font-weight="bold" fill="white">S</text>
      </svg>
    </div>
    <h2>Provisioning Device</h2>

    <form class="form" action="/submit" method="post">
      <div class="ssid-list">
        <label for="wifi_ssid">SSIDs</label>
        <select id="wifi_ssid" name="wifi_ssid">
          <option value="%s">cuevita</option>
          <option value="%s">cuevita5</option>
          <option value="%s">Personal Wifi Zon</option>
        </select>
        <button id="spinner-button" type="button" onclick="fetchSSIDs()"><span>â†»</span></button>
        <div id="spinner"></div>
      </div>
      <div class="form">Password: <input type="password" name="wifi_password" /><br /></div>
      <div class="form">Mesh Name: <input type="text" name="mesh_name" /><br /></div>
      <div class="form"></siv>Email: <input type="text" name="email" /><br /></div>
      <input type="submit" value="Submit" />
    </form>
    <script>
        function fetchSSIDs() {
            var select = document.getElementById("wifi_ssid");
            var form = document.getElementById("provision-form");
            var spinner = document.getElementById("spinner");
            var refreshButton = document.getElementById("spinner-button");
            
            spinner.style.display = "inline-block";
            refreshButton.style.display = "none"

            fetch('/scan')
                .then(response => response.json())
                .then(data => {
                    const selectElement = document.getElementById('wifi_ssid');
                    selectElement.innerHTML = '';
                    data.ssids.forEach(ssid => {
                        const option = document.createElement('option');
                        option.value = ssid;
                        option.textContent = ssid;
                        selectElement.appendChild(option);
                    });
                    spinner.style.display = "none";
                    refreshButton.style.display = "inline-block";
                })
                .catch(error => {
                    console.error('Error fetching network list:', error);
                });
        }

        document.addEventListener('DOMContentLoaded', fetchSSIDs);
    </script>
  </body>
</html>
